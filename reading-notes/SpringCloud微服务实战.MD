## 基础知识

### 微服务的优势
1. 服务独立部署，相互之间影响较小。
2. 可以为每个服务性能进行评估，以确定其瓶颈。

### 微服务的劣势
1. 由于服务的拆分，运维和测试将变得更为复杂。
2. 分布式系统带来复杂性(分布式事务、网络不稳定)

## 微服务构建SpringBoot

### SpringBoot的优势
1. 使用大量的自动化配置来简化Spring原有样板化的配置
2. 使用模块化的starter来定义引用，使依赖管理更简单
3. 内置容器，使部署启动更轻便

### SpringBoot文件加载顺序
1. 在命令行中传入的参数
2. 操作系统的环境变量
3. 位于当前应用jar包之外，针对不同profile环境的配置文件内容
4. 位于当前应用jar包之内，针对不同profile环境的配置文件内容
5. 位于当前应用jar包之外的application.properties和yaml配置内容
6. 位于当前应用jar包之内的application.properties和yaml配置内容

### 应用配置类
/autoconfig 用来获取应用的自动化配置报告，列出了每个候选项是否满足自动化配置的各个先决条件，所以它可以帮我们找出一些自动化配置没有生效的具体原因。positiveMatches中返回的是条件匹配成功的自动化配置。negativeMatches中返回的是条件匹配不成功的自动化配置。


## 服务治理Spring Cloud Eureka
### 服务提供者
#### 服务注册
服务提供者启动的时候会通过发送REST请求的方式将自己注册到eureka server上，eureka server接受到REST请求后，将元数据信息存储在Map中。

#### 服务同步
服务注册中心会互相注册为服务，当服务提供者发送注册请求到一个服务注册中心时，它会将请求转发给集群中相连的其他注册中心，从而实现注册中心之间的数据同步。

#### 服务续约
注册完服务之后，服务提供者会和eureka server维护心跳，防止euruka server将服务剔除。

### 服务消费者
#### 获取服务
启动服务消费者的时候，它会发送一个REST请求给服务注册中心，来获取上面注册的服务清单。为了性能考虑，eureka server会维护一份只读的服务清单来返回给客户端，该缓存清单每隔30s更新一次。

#### 服务调用
服务消费者在获取服务清单后，通过服务名可以获得具体提供服务的实例名和该实例的元数据信息。然后借助ribbon实现客户端负载均衡。

#### 服务下线
当服务实例进行正常的关闭操作时，它会触发一个服务下线的REST请求给eureka server，注册中心接受到请求之后，将该服务状态置为下线，并通知其他eureka server。

### 服务注册中心
#### 失效剔除
有时由于服务实例宕机，导致服务注册中心并未接受到下线请求，为了将这些无法提供服务的实例剔除，eureka server会启动一个定时任务，每隔一段时间将清单中超时未续约的服务剔除出去。

#### 自我保护
eureka server运行期间，如果心跳失败的比例过高(通常由于网络原因)，eureka server会将当前的实例注册信息保护起来，让这些实例不会过期。

## 客户端负载均衡Spring Cloud Ribbon
### 服务端负载均衡
需要借助硬件(F5)或软件(Nginx)来完成请求分发工作，负载中间件会维护一个可用的服务端清单，通过心跳检测来剔除故障的服务端节点以保证清单中都是可以正常访问的服务端节点。

### 客户端负载均衡
所有的客户端节点都维护者自己要访问的服务端清单，而这些服务端清单来自于服务注册中心。

## 服务容错保护Spring Cloud Hystrix


## 声明式服务调用Spring Cloud Feign


## API网关服务Spring Cloud Zuul


## 分布式配置中心Spring Cloud Config


## 消息总线Spring Coud Bus


## 消息驱动的微服务Spring Cloud Stream


## 分布式服务跟踪Spring Cloud Sleuth
