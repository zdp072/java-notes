# 了解web及网络安全

## 基础信息
1. web是建立在http协议之上进行通信的
2. http/1.1是目前主流的http协议版本
3. 与互联网相关联的协议集合起来总称为TCP/IP

## TCP/IP的分层管理

### 应用层协议
应用层决定了向用户提供应用服务时通信的活动。
比如FTP、DNS、HTTP协议

### 传输层协议
传输层对上层应用层提供网络连接中的两台计算机之间的数据传输。
比如TCP、UDP协议

### 网络层协议
网络层用来处理在网络上流动的数据包，该层规定了通过什么路线将数据包发送给对方
比如IP协议

### 数据链路层协议
用来处理连接网络的硬件部分
比如网卡、光纤等物理可见部分

通过TCP/IP协议栈进行网络通信时，会通过分层顺序与对方进行通信。发送端从应用层往下走，接收端则往应用层上走。

## 协议详细解析
### IP协议
IP协议的作用是把各种数据包传送给对方，IP地址指明了节点被分配到的地址，MAC地址是指网卡所属的固定地址。

### TCP协议
TCP协议确保了传输的可靠性，它会将大块的数据分割成报文段为单位的数据包。

### DNS协议
提供域名到IP地址之间的解析服务。

# 简单的http协议
## 无状态
所谓的无状态是说http自身不对请求和响应之间的通信状态进行保存，不会做持久化处理。

如果期望保持状态功能，可以使用cookie。

## 持久连接
在http/1.1中，所有的连接默认都是持久连接，持久连接旨在建立1次TCP连接后进行多次请求和响应的交互。
持久连接的好处在于减少了TCP连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。

## 管线化
可同时并行发送多个请求，而不需要一个接一个地等待响应。

# http报文中的http信息
## http报文
1. http在传输数据时可以通过编码提升传输效率。
2. http在传输大容量数据时，会通过把数据分割成多块传输。
3. 可以实现指定下载的实体范围。

# 返回结果的http状态码
## 状态码的类别
1. 1XX 请求正在处理
2. 2XX 成功处理
3. 3XX 请求重定向
4. 4XX 客户端错误
5. 5XX 服务端错误

# 与http协作的web服务器
## 虚拟主机
使用虚拟主机可以实现一台主机托管多个域名

## 通信数据转发程序
代理（NG）、网关（ZUUL）、隧道（VPN）

## 使用代理服务器的目的
1. 利用缓存技术
2. 鉴权以达到访问权限控制
3. 获取访问日志

## 缓存
1. 使用缓存技术减少对目标服务器的访问，节省通信流量和通信时间。
2. 服务端缓存和客户端缓存都会设置缓存过期时间。

# http首部

## 通用首部字段

### cache-control 用来操作缓存的工作机制
- public：表明其他用户也可利用缓存
- private：只对特定用户提供资源缓存的服务
- no-cache：不缓存过期的资源
- no-store: 请求或响应包含机密信息，不能缓存
- s-maxage：只适用于供多为用户使用的公共缓存服务器
- max-age：代表资源保存为缓存的最长时间
- min-fresh：要求缓存服务器返回至少还未过指定时间的缓存资源
- max-stale：指示缓存资源，即使过期也照常接受
- only-if-cached：要求缓存服务器不重新加载响应
- must-revalidate：向源服务器再次验证即将返回的响应缓存目前是否有效
- proxy-revalidate：要求所有的缓存服务器在接受到客户端带有该指令的请求返回响应之前，必须再次验证缓存的有效性
- no-transform：无论是在请求还是响应中，缓存都不能改变实体主体的媒体类型

### connection
- 控制不再转发给代理的首部字段
- 管理持久连接

http/1.1版本默认连接都是持久连接

### Date
首部字段Date表明创建http报文的日期和时间

### Pragma
历史遗留字段，仅作为与http/1.0的向后兼容而定义

### Trailer
事先说明在报文主题后记录了哪些首部字段

### Trailer Encoding
规定了传输报文主体时采用的编码方式

### Upgrade
用于检测http协议以及其他协议是否可使用更高版本进行通信

### Via
追踪客户端和服务器之间的请求和响应报文的传输路径

### Warning
告知用户一些与缓存相关问题的警告

## 请求首部字段
### Accept
通知服务器，用户代理能够处理的媒体类型及媒体类型优先级

### Accept-Charset
通知服务器用户代理支持的字符集及字符集的相对优先顺序

### Accept-Encoding
告知服务器用户代理支持的内容编码及内容编码的优先级顺序

### Accept-Language
告知服务器用户代理能够处理的自然语言集以及优先级

### Authorization
告知服务器，用户代理的认证信息（证书值）

### Expect
告知服务器，期望出现的某种特定行为

### From
告知服务器使用用户代理的用户的电子邮件地址

### Host
告知服务器，请求的资源所处的互联网主机名和端口号

### If-Match
服务器会比对If-Match的字段值和资源的ETag值，二者一致才会执行请求。

if-xxx这种央视的请求首部字段，都可成为条件请求。服务器接收到附带条件的请求后，只有判断指定条件为真时，才会执行请求。

### If-Modified-Since
用于确认代理或客户端拥有的本地资源的有效性

### If-None-Match
只有If-None-Match的字段值与ETag值不一致时，可处理该请求。与If-Match首部字段的作用相反。

### If-Range
告知服务器若指定If-Range字段值和请求资源的ETag值或时间相一致时，则作为范围请求处理。反之，则返回全体资源。

### If-Unmodified-Since
告知服务器，指定的请求资源只有在字段值内指定的日期时间之后，未发生更新的情况下，才能处理请求。

### Max-Forwards
服务器在往下一个服务器转发请求之前，Max-Forwards的值减1后重新赋值。当服务器接受到Max-Forwards值为0的请求时，则不进行转发，而是直接返回响应。

### Proxy-Authorization
告知服务器认证所需要的信息

### Range
告知服务器资源的指定范围

### Referer
告知服务器请求的原始资源的URI

### TE
告知服务器客户端能够处理响应的传输编码方式及优先级

### User-Agent
创建请求的浏览器和用户代理名称等信息传达给服务器

## 响应首部字段
### Accept-Ranges
用来告知客户端服务器是否能处理范围请求

### Age
告知客户端，源服务器多久前做了响应

### ETag
告知客户端实体标记

### Location
将响应接受方引导至某个与请求URI位置不同的资源

### Proxy-Authenticate
把代理服务器所要求的认证信息发送给客户端

### Retry-After
告知客户端应该在多久之后再次发送请求

### Server
告知客户端当前服务器上安装的http服务器应用程序的信息

### Vary
对缓存进行控制

### WWW-Authenticate
用于http访问认证

## 实体首部字段
包含在请求报文和响应报文中的实体部分所使用的首部

### Allow
通知客户端能够支持Request-URI指定资源的所有HTTP方法

### Content-Encoding
告知客户端服务器对实体的主体部分选用的内容编码方式
gzip/compress/deflate/identity

### Content-Language
告知客户端实体主体使用的自然语言

### Content-Length
表明了实体主体部分的大小

### Content-Location
报文主体返回资源对应的URI

### Content-MD5
检查报文主体在传输过程中是否保持完整，以便确认传输到达

### Content-Range
告知客户端作为响应返回的实体的哪个部分符合范围请求

### Content-Type
说明了实体主体内对象的媒体类型

### Expires
将资源失效的日期告知客户端

### Last-Modified
指明资源最终修改的时间

## 为Cookie服务的首部字段
cookie的工作机制是用户识别及状态管理

#### expires
指定浏览器可发送Cookie的有效期

#### path
限制指定Cookie的发送范围的文件目录

#### domain
domain属性指定的域名可做到与结尾匹配一致

#### secure
用于限制web页面尽在https安全连接时才可以发送Cookie

#### HttpOnly
使javascript脚本无法获得cookie

## 其他首部字段

#### X-Frame-Options
用于控制网站内容在其他Web网站的Frame标签内的显式问题

#### X-XSS-Protection
真滴跨站脚本共计XSS的一种策略

#### DNT
拒绝个人信息被收集

#### P3P
用于保护个人隐私

# 确保web安全的https
## http的缺点
1. 通信使用明文，内容可能会被窃听
2. 不验证通信方的身份，因此有可能遭遇伪装
3. 无法证明报文的完整性，所以内容有可能遭遇篡改

## https是身披SSL外壳的http
通常http直接和tcp通信，当使用ssl时，则演变成为先和ssl通信，再由ssl和tcp通信

## SSL为啥慢
1. 通信慢
2. 大量消耗CPU和内存资源，导致处理速度变慢

## 如何选择
如果是非敏感信息则使用http通信
只有包含个人信息等敏感信息时，才利用https加密通信。

# 确认用户访问
## http使用的认证方式
1. basic认证（基本认证）
2. digest认证（摘要认证）
3. ssl客户端认证
4. FormBase认证（基于表单认证）- 常用

## session管理和cookie应用
使用cookie来管理session，以弥补http协议中不存在的状态管理功能

## 如何保存用户密码
1. 给密码加盐
2. 使用散列函数计算散列值保存

# 基于http的功能追加协议
## SPDY
SPDY以会话层的形式加入，控制对数据的流动，但还是采用HTTP建立通信连接。

#### 多路复用流
通过单一的TCP连接，可以无限处理多个http请求。所有请求的处理都在一条TCP连接上完成。

#### 赋予请求优先级
给请求逐个分配优先级顺序，这样主要是为了在发送多个请求时，解决因带宽低而导致响应变慢的问题。

#### 压缩http首部
压缩http请求和响应的首部，这样一来，通信产生的数据包数量和发送的字节数就更少了

#### 推送功能
支持服务器主动向客户端推送数据的功能

#### 服务器提示功能
服务器可以主动提示客户端请求所需的资源。

## WebSocket
websocket是建立在http基础上的协议，连接的发起方仍是客户端。

#### 推送功能
支持由服务器向客户端推送数据的推送功能

#### 减少通信量
只要建立起websocket连接，就希望一直保持连接状态

## HTTP2.0
目标是改善用户在使用web时的速度体验

# web的攻击技术
## 跨站脚本攻击（XSS）
使用用户的浏览器运行非法的HTMl标签或javascript脚本进行的一种攻击。

## SQL注入攻击
对数据库运行非法的sql而产生的攻击

## OS命令注入攻击
从web应用通过shell来调用操作系统命令

## 会话劫持
攻击者通过某种手段拿到了用户的会话ID，并非法使用此用户ID伪装成用户，达到攻击的目的。

## 跨站点请求伪造（CSRF）
攻击者通过设置好的陷阱，强制对已完成认证的用户进行非预期的个人信息或设定信息等某些状态更新。

## DDoS攻击
发送大量的请求，让运行中的服务呈停止状态的攻击